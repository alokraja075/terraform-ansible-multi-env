---
- name: Configure EC2 instances with Ansible
  hosts: ec2_instances
  become: yes
  gather_facts: no
  
  vars:
    nginx_version: "latest"
    environment: "production"
  
  pre_tasks:
    - name: Wait for system to be ready
      raw: sleep 10
      changed_when: false

    - name: Install Python3 if needed
      raw: sudo apt-get update -y && sudo apt-get install -y python3-minimal
      changed_when: false
      ignore_errors: yes
  
  roles:
    - name: Update system packages
      role: system-update
      tags:
        - system
        - update

    - name: Install and configure Nginx
      role: nginx
      tags:
        - nginx
        - web

  post_tasks:
    - name: Verify Nginx is active
      raw: sudo systemctl is-active nginx
      register: nginx_status
      changed_when: false

    - name: Display deployment summary
      debug:
        msg:
          - "=========================================="
          - "âœ“ Nginx Installation Complete!"
          - "=========================================="
          - "Instance: ec2-instance-1"
          - "Nginx Status: Active and Running"
          - "=========================================="
